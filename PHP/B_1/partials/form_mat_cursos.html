
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario de Matrícula</title>
</head>

<body>

    <h2>Formulario de Matrícula</h2>
    
    <form id="matriculaForm">
        <label for="cursos">Cursos disponibles:</label>
        <select id="cursos" name="curso" onchange="cargarDatosCurso()">
            <!-- Opciones de cursos se cargarán dinámicamente con Fetch -->
        </select>
    
        <p id="precio">Precio del curso: </p>
        <p id="vacantes">Vacantes disponibles: </p>
    
        <button type="button" onclick="realizarMatricula()">Matricular</button>
    </form>
    
    <script>
        // Función para cargar la lista de cursos disponibles al cargar la página
        document.addEventListener("DOMContentLoaded", function () {
            cargarListaCursos();
        });
    
        // Función para cargar la lista de cursos disponibles
        function cargarListaCursos() {
            const cursosSelect = document.getElementById("cursos");
    
            // Realizar una solicitud Fetch para obtener la lista de cursos
            fetch("portal0.php?action=cursosDisponibles&pet=partial")
                .then(response => response.json())
                .then(data => {
                    // Llenar el elemento <select> con las opciones de cursos
                    Object.keys(data).forEach(curso => {
                        const option = document.createElement("option");
                        option.value = curso;
                        option.text = curso;
                        cursosSelect.add(option);
                    });
                })
                .catch(error => console.error("Error al obtener la lista de cursos:", error));
        }
    
        // Función para cargar los datos del curso seleccionado
        function cargarDatosCurso() {
            const cursosSelect = document.getElementById("cursos");
            const cursoSeleccionado = cursosSelect.value;
    
            // Realizar una solicitud Fetch para obtener datos del curso seleccionado
            fetch(`portal0.php?action=cursosDisponibles&pet=partial`)
                .then(response => response.json())
                .then(data => {
                    const curso = data[cursoSeleccionado];
                    if (curso) {
                        document.getElementById("precio").innerText = `Precio del curso: ${curso.precio}`;
                        document.getElementById("vacantes").innerText = `Vacantes disponibles: ${curso.vacantes}`;
                    }
                })
                .catch(error => console.error("Error al obtener datos del curso:", error));
        }
    
        // Función para realizar la matrícula
        function realizarMatricula() {
            const cursosSelect = document.getElementById("cursos");
            const cursoSeleccionado = cursosSelect.value;
    
            // Realizar una solicitud Fetch para matricular al usuario
            fetch(`portal0.php?action=matriculaCursos&pet=partial&curso=${cursoSeleccionado}&user=admin1`) // Reemplaza XX con el ID de usuario real
                .then(response => response.json())
                .then(data => {
                    if (data.matricula === "correcta") {
                        // Eliminar el formulario y mostrar mensaje de éxito
                        document.getElementById("matriculaForm").reset();
                        alert("Usuario matriculado correctamente en el curso " + cursoSeleccionado);
                    } else {
                        // Mostrar mensaje de error en caso de falla
                        alert("Error al realizar la matrícula: " + data.mensaje);
                    }
                })
                .catch(error => console.error("Error al realizar la matrícula:", error));
        }
    </script>
    
    </body>
    </html>